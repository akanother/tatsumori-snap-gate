import{f as o,o as r,b as e,e as l,t as d,n as _,h as u,i as p,v as g,D as y,F as h,k as m,I as b}from"./app-DNec1a2P.js";import{_ as v}from"./_plugin-vue_export-helper-DlAUqK2U.js";const x={name:"ShareFileRoomPage",props:{token:{type:String,required:!0},room:{type:Object,required:!0}},data(){return{password:"",errorMessage:"",isAuthenticated:!1,files:[],csrf:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),userLang:"ja",noticeTexts:{ja:["このページは当社から通知されたお客様専用です。他者へのURL共有は禁止されています。","ダウンロードしたファイルは通知された用途以外での使用を禁止します。","有効期限を過ぎるとアクセスできなくなります。期限内にダウンロードしてください。","ご不明点がございましたら、担当営業または弊社窓口までご連絡ください。"],en:["This page is exclusively for customers notified by our company. Sharing the URL with others is strictly prohibited.","The downloaded files must not be used for any purpose other than the intended one.","After the expiration date, access to the files will no longer be available. Please download them within the period.","If you have any questions, please contact your sales representative or our support desk."],zh:["此页面仅供我司通知的客户使用，禁止与他人共享此URL。","下载的文件不得用于通知内容以外的用途。","过期后将无法访问，请在有效期内下载文件。","如有疑问，请联系负责的销售人员或我司客服。"],ko:["이 페이지는 당사에서 통지한 고객 전용입니다. 다른 사람과의 URL 공유는 금지됩니다.","다운로드한 파일은 통지된 용도 이외의 사용을 금지합니다.","유효 기간이 지나면 접근할 수 없으니 기간 내에 다운로드해 주십시오.","문의사항이 있으시면 담당 영업 또는 당사 창구로 연락해 주십시오."]}}},mounted(){this.room.requires_password||this.fetchFiles();const t=(navigator.language||navigator.userLanguage).split("-")[0];this.userLang=t},methods:{async submitPassword(){if(!this.password){this.errorMessage="パスワードを入力してください";return}this.errorMessage="";try{const s=await b.post("/r/verify",{token:this.token,password:this.password});s.data.status==="ok"?(this.isAuthenticated=!0,this.fetchFiles()):this.errorMessage=s.data.message||"認証に失敗しました"}catch(s){console.error(s),this.errorMessage="システムエラーが発生しました"}},async fetchFiles(){try{const s=await b.get(`/r/files/${this.token}`);this.files=s.data.files||[]}catch(s){console.error("ファイル一覧取得エラー",s),this.errorMessage="ファイル一覧が取得できませんでした"}},formatSize(s){return s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB"}}},w={class:"container-fluid p-0"},k={key:0,class:"navbar navbar-expand-lg navbar-dark bg-gradient-primary shadow-sm px-3"},L={key:1,class:"navbar navbar-dark bg-external-header shadow-sm justify-content-center"},S={class:"bg-light py-3 text-center border-bottom"},M={class:"h4 mb-0"},P={class:"container my-4"},F={key:0,class:"text-center"},T={key:0,class:"card-header bg-light text-center fw-bold"},R={class:"card-body"},j={key:0,class:"mt-3 text-danger small"},q={key:1},B={class:"d-flex justify-content-end mb-3"},U=["action"],A=["value"],V={key:0,class:"text-center text-muted"},C={key:1,class:"table-responsive"},I={class:"table table-striped file-table"},N={class:"text-end"},D={class:"text-center"},K={class:"text-center"},O=["action"],z=["value"],E=["value"],G={class:"mt-4"},Z={key:0,class:"alert alert-info border internal-notice"},H={key:1,class:"alert alert-light border external-notice"},J={class:"fw-bold mb-2"},Q={class:"mb-0 small"};function W(s,t,i,X,n,c){return r(),o("div",w,[i.room.target_scope==="internal"?(r(),o("header",k,t[3]||(t[3]=[e("div",{class:"container-fluid"},[e("span",{class:"navbar-brand fw-bold d-flex align-items-center"},[e("i",{class:"fas fa-cloud me-3"}),l(" SnapGate File Share Room ")])],-1)]))):(r(),o("header",L,t[4]||(t[4]=[e("span",{class:"navbar-brand fw-bold"}," 株式会社 龍森　ファイルダウンロード ",-1)]))),e("div",S,[e("h2",M,d(i.room.name),1)]),e("div",P,[i.room.requires_password&&!n.isAuthenticated?(r(),o("div",F,[e("div",{class:_(["card mx-auto",i.room.target_scope==="external"?"external-auth-card":""]),style:{"max-width":"400px"}},[i.room.target_scope==="external"?(r(),o("div",T," セキュア認証 ")):u("",!0),e("div",R,[t[5]||(t[5]=e("p",{class:"small text-muted text-start mb-3"},[l(" 通知された認証コードを入力してください。"),e("br"),l(" このコードは弊社担当者より安全に送信されています。 ")],-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.password=a),type:"password",class:"form-control form-control-lg mb-3",placeholder:"認証コードを入力",onKeyup:t[1]||(t[1]=y((...a)=>c.submitPassword&&c.submitPassword(...a),["enter"]))},null,544),[[g,n.password]]),e("button",{class:"btn btn-primary w-100 fw-bold",onClick:t[2]||(t[2]=(...a)=>c.submitPassword&&c.submitPassword(...a))}," 認証する "),n.errorMessage?(r(),o("div",j,d(n.errorMessage),1)):u("",!0)])],2)])):(r(),o("div",q,[e("div",B,[e("form",{action:`/r/zip/${i.token}`,method:"POST"},[e("input",{type:"hidden",name:"_token",value:n.csrf},null,8,A),t[6]||(t[6]=e("button",{class:"btn btn-success"},[e("i",{class:"fas fa-file-archive me-2"}),l(" 全ファイルをZIPでダウンロード ")],-1))],8,U)]),n.files.length===0?(r(),o("div",V," ファイルがまだ登録されていません ")):(r(),o("div",C,[e("table",I,[t[8]||(t[8]=e("thead",null,[e("tr",null,[e("th",null,"ファイル名"),e("th",{class:"text-end"},"サイズ"),e("th",{class:"text-center"},"アップロード日時"),e("th",{class:"text-center"},"操作")])],-1)),e("tbody",null,[(r(!0),o(h,null,m(n.files,a=>(r(),o("tr",{key:a.id},[e("td",null,d(a.name),1),e("td",N,d(c.formatSize(a.size)),1),e("td",D,d(a.uploaded_at),1),e("td",K,[e("form",{action:`/r/f/${a.id}`,method:"POST",style:{display:"inline"}},[e("input",{type:"hidden",name:"_token",value:n.csrf},null,8,z),e("input",{type:"hidden",name:"path",value:a.path},null,8,E),t[7]||(t[7]=e("button",{class:"btn btn-sm btn-outline-primary"},[e("i",{class:"fas fa-download"}),l(" ダウンロード ")],-1))],8,O)])]))),128))])])]))])),e("div",G,[i.room.target_scope==="internal"?(r(),o("div",Z,t[9]||(t[9]=[e("h6",{class:"fw-bold mb-2"},[e("i",{class:"fas fa-info-circle me-2"}),l(" 注意事項 ")],-1),e("ul",{class:"mb-0 small"},[e("li",null,"このシステムは社内利用専用です。第三者へのURL共有は禁止されています。"),e("li",null,"ダウンロードしたファイルは社内業務以外での使用を禁止します。"),e("li",null,"アクセス権限がない場合はシステム管理者に連絡してください。")],-1)]))):(r(),o("div",H,[e("h6",J,[t[10]||(t[10]=e("i",{class:"fas fa-exclamation-triangle text-warning me-2"},null,-1)),l(" "+d(n.userLang==="ja"?"注意事項":"Notice"),1)]),e("ul",Q,[(r(!0),o(h,null,m(n.noticeTexts[n.userLang]||n.noticeTexts.ja,(a,f)=>(r(),o("li",{key:f},d(a),1))),128))])]))])])])}const ee=v(x,[["render",W],["__scopeId","data-v-68fe189e"]]);export{ee as default};
