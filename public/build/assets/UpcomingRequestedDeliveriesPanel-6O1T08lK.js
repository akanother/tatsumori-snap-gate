import _ from"./BaseKpiCard-BpEHQQg2.js";import{r as y,f as a,o as n,a as f,w as v,b as o,h as m,i as b,F as c,k as h,t as l,q as k}from"./app-DU-_PAUJ.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={name:"UpcomingRequestedDeliveriesPanel",components:{BaseKpiCard:_},data(){return{loading:!0,days:{},orderedKeys:[],lastUpdated:null,error:null,selectedOrganization:"",organizations:["","郡山","岐阜"]}},mounted(){this.fetchData()},computed:{totalCount(){return Object.values(this.days).reduce((t,s)=>t+((s==null?void 0:s.length)||0),0)},dayTiles(){return this.orderedKeys.map(t=>({date:t,items:this.days[t]||[]}))},orgLabel(){return this.selectedOrganization?`（${this.selectedOrganization}）`:"（全て）"}},methods:{async fetchData(){this.loading=!0,this.error=null;try{const{data:t}=await axios.get(route("api.dashboard.upcoming.requested-deliveries"),{params:{organization:this.selectedOrganization||void 0}});this.days=t||{},this.orderedKeys=Object.keys(this.days).sort(),this.lastUpdated=new Date}catch(t){console.error(t),this.error="読み込みに失敗しました"}finally{this.loading=!1}},shortName(t,s=8){return t?t.length<=s?t:`${t.slice(0,s)}…`:""},toDisp(t){const[s,u,g]=t.split("-").map(i=>parseInt(i,10));return`${u}/${g}`},onChangeOrg(){this.loading||this.fetchData()}}},C={class:"col-sm-6"},D={class:"w-100 d-flex justify-content-end mb-2"},O=["value"],z={class:"fw-bold mb-1"},U={key:0,class:"display-5 text-dark"},B={key:1,class:"fs-3"},K={key:0,class:"calendar-grid w-100"},N={class:"d-flex justify-content-between align-items-center mb-1"},j={class:"date-label"},q={class:"badge badge-light count-badge"},R={key:0,class:"chips"},V=["title"],L=["title"],F={key:1,class:"text-muted tiny"},I={key:1,class:"calendar-grid w-100"},P={key:2,class:"text-danger small mt-2"};function S(t,s,u,g,i,r){const p=y("BaseKpiCard");return n(),a("div",C,[f(p,{title:`当日以降〜30日 希望納期（受注のみ）${r.orgLabel}`,loading:i.loading,lastUpdated:i.lastUpdated,onRefresh:r.fetchData},{default:v(()=>[o("div",D,[b(o("select",{class:"form-control form-select form-select-sm w-auto","onUpdate:modelValue":s[0]||(s[0]=e=>i.selectedOrganization=e),onChange:s[1]||(s[1]=(...e)=>r.onChangeOrg&&r.onChangeOrg(...e))},[(n(!0),a(c,null,h(i.organizations,e=>(n(),a("option",{key:e,value:e},l(e===""?"全て":e),9,O))),128))],544),[[k,i.selectedOrganization]])]),o("div",z,[i.loading?(n(),a("span",B,"...")):(n(),a("h4",U,l(r.totalCount)+"件",1))]),s[3]||(s[3]=o("div",{class:"w-100 my-2",style:{height:"1px",background:"rgba(0,0,0,.06)"}},null,-1)),i.loading?(n(),a("div",I,[(n(),a(c,null,h(14,e=>o("div",{key:e,class:"day-tile"},s[2]||(s[2]=[o("div",{class:"skeleton",style:{height:"18px",width:"60%","margin-bottom":"6px"}},null,-1),o("div",{class:"skeleton",style:{height:"20px",width:"100%","border-radius":"999px"}},null,-1),o("div",{class:"skeleton",style:{height:"20px",width:"80%","border-radius":"999px","margin-top":"6px"}},null,-1)]))),64))])):(n(),a("div",K,[(n(!0),a(c,null,h(r.dayTiles,e=>(n(),a("div",{key:e.date,class:"day-tile"},[o("div",N,[o("span",j,l(r.toDisp(e.date)),1),o("span",q,l(e.items.length),1)]),e.items.length?(n(),a("div",R,[(n(!0),a(c,null,h(e.items.slice(0,3),(d,T)=>(n(),a("span",{key:d.order_detail_id,class:"chip",title:d.customer_name+" / "+(d.product_name||"")},l(r.shortName(d.customer_name)),9,V))),128)),e.items.length>3?(n(),a("span",{key:0,class:"chip more",title:`${e.items.length-3} 件 さらにあります`}," +"+l(e.items.length-3),9,L)):m("",!0)])):(n(),a("div",F,"予定なし"))]))),128))])),i.error?(n(),a("div",P,l(i.error),1)):m("",!0)]),_:1,__:[3]},8,["title","loading","lastUpdated","onRefresh"])])}const G=x(w,[["render",S],["__scopeId","data-v-9ff9ae85"]]);export{G as default};
